<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<tb:token xmlns:tb="http://attestation.id/ns/tbml">
  <tb:contract id="holding_contract" type="holding">
    <tb:address network="3">0x999641E21f6C3e008CB7Ff0e221402F336b9777f</tb:address>
    <tb:name lang="ru">Ваучеры</tb:name>
    <tb:name lang="en">Vouchers</tb:name>
    <tb:name lang="zh">门票兑换券</tb:name>
    <tb:name lang="es">Cupones</tb:name>
    <tb:name lang="ru">Ваучеры</tb:name>
    <tb:interface>erc875</tb:interface>
  </tb:contract>
  <tb:contract type="market">
    <tb:name>Standard Meetup Contract</tb:name>
  </tb:contract>
  <tb:contract type="wallet">
    <!-- users can buy tickets using SPG points -->
    <tb:address network="1">0xdecafbaddecafbaddecafbaddecafbaddecafbad</tb:address>
    <tb:name>Starwood Preferred Guest</tb:name>
  </tb:contract>
  <!-- consider metadata of tokens, e.g. quantifier in each languages -->
  <tb:features>
    <!-- a feature is only usable if all tokens are included, but, if
         only some are excluded, the feature is still available for
         the ones that are not excluded. Think about redeem function,
         the button should be grayed out with the "include" message
         there -->
    <tb:feature type="market-queue">
      <tb:include>valid</tb:include>
      <tb:exclude>invited</tb:exclude>
      <tb:exclude>discounted</tb:exclude>
      <tb:gateway>https://482kdh4npg.execute-api.ap-southeast-1.amazonaws.com/dev/</tb:gateway>
      <tb:message lang="en" type="exclude">%name% can't be traded on the market</tb:message>
      <tb:message lang="zh" type="exclude">%name% 不能再在市场上交易</tb:message>
      <tb:message type="include">Only %name% can be traded on the market</tb:message>
      <tb:message type="include">只有%name%才可以在市场上交易</tb:message>
    </tb:feature>
    <tb:feature type="market-contract">
      <tb:include>valid</tb:include>
      <tb:exclude>discounted</tb:exclude>
      <tb:exclude>invited</tb:exclude>
      <!-- buy and sell tokens on this contract -->
      <tb:address network="1">0xdecafbaddecafbaddecafbaddecafbaddecafbad</tb:address>
      <tb:message lang="en" type="exclude">%name% can't be traded on the market</tb:message>
      <tb:message lang="zh" type="exclude">%name% 不能再在市场上交易</tb:message>
      <tb:message type="include">Only %name% can be traded on the market</tb:message>
      <tb:message type="include">只有%name%才可以在市场上交易</tb:message>
    </tb:feature>
    <tb:feature type="magic-link">
      <tb:include>valid</tb:include>
      <tb:exclude>discounted</tb:exclude>
      <tb:prefix>https://app.awallet.io/</tb:prefix>
      <tb:message lang="en" type="exclude">%name% can't be traded with MagicLink</tb:message>
      <tb:message type="include">Only %name% can be traded with MagicLink</tb:message>
      <tb:message lang="zh" type="exclude">%name% 不能用MagicLink交易</tb:message>
      <tb:message lang="zh" type="include">只有末到期的票才可以用MagicLink交易</tb:message>
    </tb:feature>
    <tb:feature type="transfer-link">
      <tb:exclude>discounted</tb:exclude>
      <tb:exclude>invited</tb:exclude>
      <tb:prefix>https://app.awallet.io/</tb:prefix>
      <tb:message lang="en" type="exclude">%name% can't be traded on the market</tb:message>
      <tb:message lang="zh" type="exclude">%name% 不能再在市场上交易</tb:message>
    </tb:feature>
    <tb:feature type="feemaster">
      <tb:exclude>expired</tb:exclude>
      <tb:feemaster>https://app.awallet.io:80/api/claimToken</tb:feemaster>
      <tb:message lang="en" type="include">%name% can't be imported</tb:message>
      <tb:message lang="zh" type="include">不能收下%name%</tb:message>
    </tb:feature>
    <tb:feature type="qr-redeem">
      <tb:include>valid</tb:include>
      <tb:redeem format="Aztec"/>
      <tb:message lang="en" type="include">Only %name% can be redeemed for paper tickets</tb:message>
      <tb:message lang="zh" type="include">只有%name%才可以兑换纸票</tb:message>
    </tb:feature>
    <tb:feature type="nfc-redeem">
      <tb:include>valid</tb:include>
      <tb:device>decafbaddecafbad</tb:device>
      <tb:message lang="en" type="include">Only %name% can be redeemed for paper tickets</tb:message>
      <tb:message lang="zh" type="include">只有%name%才可以兑换纸票</tb:message>
    </tb:feature>
  </tb:features>
  <tb:selections>
    <tb:selection id="discounted">
      <tb:name lang="en">Discount Tickets</tb:name>
      <tb:name lang="zh">打折票</tb:name>
      <tb:filter>(|category=打折票)(category=Discounted))</tb:filter>
    </tb:selection>
    <tb:selection id="invited">
      <tb:name lang="en">Gift Ticket</tb:name>
      <tb:name lang="zh">赠票</tb:name>
      <tb:filter>gifted</tb:filter>
    </tb:selection>
    <tb:selection id="valid">
      <tb:name lang="en">Tickets not expired</tb:name>
      <tb:name lang="zh">末到期票</tb:name>
      <tb:filter>!expired</tb:filter>
    </tb:selection>
    <tb:selection id="expired">
      <tb:name lang="en">Expired Tickets</tb:name>
      <tb:name lang="zh">已经过期的票</tb:name>
      <tb:filter>expired</tb:filter>
    </tb:selection>
  </tb:selections>
  <tb:grouping>
    <tb:group bitmask="FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF" name="default">
      <tb:consecutive_groups/>
    </tb:group>
  </tb:grouping>
  <tb:ordering>
    <tb:order bitmask="FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF" name="default">
      <tb:byName field="locality"/>
      <tb:byValue field="match"/>
      <tb:byValue field="number"/>
    </tb:order>
    <tb:order bitmask="FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF" name="concise">
      <tb:byValue field="match"/>
      <tb:byValue field="category"/>
      <tb:byValue field="number"/>
    </tb:order>
  </tb:ordering>

  <!-- token UI definition can happen here -->
  <tb:attribute-types>
    <!--

    Information about a meetup, like Country, City, time,
	can all be looked up by TokenID. There are
    advantages and disadvantages in encoding them by a look up table
    or by a bit field.

    The advantage of storing them as a bit field is that one can
    enquiry the range of it in the market queue server without the
    server kowing the meaning of the bitfields. Furthermore it make
    the android and ios library which accesses the XML file a bit
    easier to write, but at the cost that the ticket issuing
    (authorisation) server is a bit more complicated.

    For now we decide to use bit-fields.  The fields, together with
    its bitwidth or byte-width are represented in this table:

    country	  		 FF00000000000000000000000000000000000000000000000000000000000000
	locality 1 byte	 FF00000000000000000000000000000000000000000000000000000000000000
	time	 19 byte 00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000000
	numero	 2 byte  0000000000000000000000000000000000000000FFFF00000000000000000000
	category 5 byte  00000000000000000000000000000000000000000000FFFFFFFFFF0000000000
	section	 5 byte  000000000000000000000000000000000000000000000000000000FFFFFFFFFF

    In practise, because this XML file is used in 3 to 4 places
    (authorisation server, ios, android, potentially market-queue),
    Weiwu thought that it helps the developers if we use byte-fields
    instead of bit-fields.
    1.3.6.1.4.1.1466.115.121.1.15 is DirectoryString
    1.3.6.1.4.1.1466.115.121.1.24 is GeneralisedTime
    1.3.6.1.4.1.1466.115.121.1.26 is IA5String
    1.3.6.1.4.1.1466.115.121.1.27 is Integer
  -->
    <tb:attribute-type id="country" oid="2.5.4.7" syntax="1.3.6.1.4.1.1466.115.121.1.15">
      <tb:name lang="en">Country</tb:name>
      <tb:name lang="zh">国家</tb:name>
      <tb:origin as="utf8" bitmask="FFFF000000000000000000000000000000000000000000000000000000000000"/>
    </tb:attribute-type>
    <tb:attribute-type id="locality" oid="2.5.4.7" syntax="1.3.6.1.4.1.1466.115.121.1.15">
      <tb:name lang="en">City</tb:name>
      <tb:name lang="zh">城市</tb:name>
      <tb:origin contract="holding-contract">
        <tb:function name="getLocality">
          <tb:inputs>
            <tb:uint256 ref="TokenID"/>
          </tb:inputs>
        </tb:function>
      </tb:origin>
    </tb:attribute-type>
    <tb:attribute-type id="time" syntax="1.3.6.1.4.1.1466.115.121.1.24">
      <tb:name lang="en">Time</tb:name>
      <tb:name lang="zh">时间</tb:name>
      <tb:origin as="utf8" bitmask="00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000000"/>
    </tb:attribute-type>
    <tb:attribute-type id="numero" syntax="1.3.6.1.4.1.1466.115.121.1.27">
      <tb:name lang="en">No</tb:name>
      <tb:name lang="zh">票号</tb:name>
      <tb:origin as="unsigned" bitmask="0000000000000000000000000000000000000000FFFF00000000000000000000"/>
    </tb:attribute-type>
    <tb:attribute-type id="category" syntax="1.3.6.1.4.1.1466.115.121.1.15">
      <tb:name lang="en">Cat</tb:name>
      <tb:name lang="zh">等级</tb:name>
      <tb:origin as="utf8" bitmask="00000000000000000000000000000000000000000000FFFFFFFFFF0000000000"/>
    </tb:attribute-type>
    <tb:attribute-type id="section" syntax="1.3.6.1.4.1.1466.115.121.1.15">
      <tb:name lang="en">Section</tb:name>
      <tb:name lang="zh">区号</tb:name>
      <tb:origin as="utf8" bitmask="000000000000000000000000000000000000000000000000000000FFFFFFFFFF"/>
    </tb:attribute-type>
    <tb:attribute-type id="expired" syntax="1.3.6.1.4.1.1466.115.121.1.7"> <!-- boolean -->
      <tb:value-sourcing>
        <tb:function contract="holding-contract" name="isExpired">
          <tb:inputs>
            <tb:uint256 ref="TokenID"/>
          </tb:inputs>
        </tb:function>
      </tb:value-sourcing>
    </tb:attribute-type>
    <tb:attribute-type id="street" syntax="1.3.6.1.4.1.1466.115.121.1.15"> <!-- string -->
      <tb:value-sourcing>
        <tb:function contract="holding-contract" name="getStreet">
          <tb:inputs>
            <tb:uint256 ref="TokenID"/>
          </tb:inputs>
        </tb:function>
      </tb:value-sourcing>
    </tb:attribute-type>
    <tb:attribute-type id="building" syntax="1.3.6.1.4.1.1466.115.121.1.15"> <!-- string -->
      <tb:origin contract="holding-contract">
        <tb:function contract="holding-contract" name="getBuildingName">
          <tb:inputs>
            <tb:uint256 ref="TokenID"/>
          </tb:inputs>
        </tb:function>
      </tb:origin>
    </tb:attribute-type>
    <tb:attribute-type id="state" syntax="1.3.6.1.4.1.1466.115.121.1.15"> <!-- string -->
      <tb:origin contract="holding-contract">
        <tb:function name="getState">
          <tb:inputs>
            <tb:uint256 ref="TokenID"/>
          </tb:inputs>
        </tb:function>
      </tb:origin>
    </tb:attribute-type>
  </tb:attribute-types>
</tb:token>
